<!DOCTYPE html>
<html>
<head>
    <title>Security Report</title>
    <meta charset="utf-8">
    <script src="https://static.line-scdn.net/liff/edge/versions/2.22.3/sdk.js"></script>
    <style>
        body { 
            font-family: sans-serif; 
            margin: 0; 
            padding: 20px;
            background: #f5f5f5;
        }
        .container { 
            max-width: 400px; 
            margin: 0 auto; 
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .report-btn { 
            width: 100%; 
            padding: 15px; 
            margin: 20px 0; 
            background: #06c755; 
            color: white; 
            border: none; 
            border-radius: 5px; 
            font-size: 18px; 
            cursor: pointer;
        }
        .report-btn:hover { background: #05a944; }
        .status { 
            padding: 15px; 
            margin: 15px 0; 
            border-radius: 5px; 
            text-align: center;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .loading { background: #fff3cd; color: #856404; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üö® ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏à‡∏∏‡∏î‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</h1>
        <div id="pointInfo"></div>
        <div id="userInfo"></div>
        
        <button class="report-btn" onclick="submitReport()">
            üìã ‡∏™‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏à‡∏∏‡∏î‡∏ô‡∏µ‡πâ
        </button>
        
        <div id="status"></div>
    </div>

    <script>
        let userId = '';
        let displayName = '';
        let pointId = '';

        // Initialize LIFF
        async function initializeLiff() {
            try {
                // üî• ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô LIFF ID ‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡∏≠‡∏á‡∏à‡∏£‡∏¥‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì!
                await liff.init({ liffId: '2008503069-jNvaAdbw' });
                
                if (!liff.isLoggedIn()) {
                    liff.login();
                    return;
                }
                
                // Get user profile
                const profile = await liff.getProfile();
                userId = profile.userId;
                displayName = profile.displayName;
                
                // Get point ID from URL
                const urlParams = new URLSearchParams(window.location.search);
                pointId = urlParams.get('point') || 'A1';
                
                // Display info
                document.getElementById('pointInfo').innerHTML = 
                    `<h2>üìç ‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà ${pointId}</h2>`;
                document.getElementById('userInfo').innerHTML = 
                    `<p>üë§ ‡∏Ñ‡∏∏‡∏ì: ${displayName}</p>`;
                    
            } catch (error) {
                console.error('LIFF error:', error);
                document.getElementById('status').innerHTML = 
                    `<div class="status error">‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î</div>`;
            }
        }

        // Submit report
        async function submitReport() {
            try {
                document.getElementById('status').innerHTML = 
                    '<div class="status loading">‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô...</div>';
                
                const response = await fetch('/api/report', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        userId: userId,
                        displayName: displayName,
                        pointId: pointId
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    document.getElementById('status').innerHTML = 
                        `<div class="status success">
                            ‚úÖ ‡∏™‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!<br>
                            ‡∏£‡∏´‡∏±‡∏™‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô: #${result.reportId}<br>
                            ‡∏Ñ‡∏∏‡∏ì‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏™‡∏£‡πá‡∏à
                        </div>`;
                } else {
                    document.getElementById('status').innerHTML = 
                        `<div class="status error">‚ùå ${result.error}</div>`;
                }
                
            } catch (error) {
                console.error('Report error:', error);
                document.getElementById('status').innerHTML = 
                    `<div class="status error">‚ùå ‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß</div>`;
            }
        }

        // Start the app when page loads
        initializeLiff();
    </script>
</body>
</html>